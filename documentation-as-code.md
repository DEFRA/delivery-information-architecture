# Documentation as Code at Defra

## Overview

This document outlines our approach to **Documentation as Code** - treating documentation with the same rigor, tooling, and processes as software code. This approach ensures documentation is maintainable, version-controlled, collaborative, and automatically generated from a single source of truth.

## What is Documentation as Code?

Documentation as Code means:

- **Version Control**: Documentation lives in Git repositories alongside code
- **Text-Based Formats**: Documentation is written in markdown, not proprietary formats
- **Automated Generation**: Multiple output formats (web, PDF, Confluence, PowerPoint) are generated from a single source
- **Code Review**: Documentation changes go through the same pull request process as code
- **CI/CD Integration**: Documentation is automatically built, validated, and deployed
- **Collaboration**: Multiple contributors can work on documentation simultaneously

## Why Documentation as Code?

### Benefits for Defra

1. **Single Source of Truth**
   - Documentation source lives in one place rather than across tools
   - No duplication or synchronization issues with e.g. offline copies
   - Changes propagate automatically to all outputs

2. **Version Control & History**
   - Full Git history of all documentation changes
   - Easy to see what changed, when, and why
   - Ability to revert changes or compare versions

3. **Collaboration**
   - Multiple team members can contribute via pull requests
   - Code review process ensures quality and consistency
   - No conflicts from simultaneous editing
   - Teams across verticals can more easily share tools and frameworks the accelerate output

4. **Automation**
   - Automated generation to multiple formats:
     - **GitHub Pages**: Interactive web documentation
     - **Confluence**: Published automatically via CI/CD
     - **PowerPoint**: Generated for presentations
     - **PDF**: Exported for offline consumption
   - Diagrams generated from code (C4, Mermaid, PlantUML)

5. **Consistency**
   - Standardized structure across all verticals
   - Shared tooling and templates
   - Common C4 element types and styles

6. **Accessibility**
   - Documentation visible in GitHub (no special tools needed)
   - Easy to find, search, and navigate
   - Works offline when cloned locally

7. **Maintainability**
   - Documentation doesn't get stale or forgotten
   - Part of the development workflow
   - Easy to update alongside code changes

8. **Artificial Intelligence**
    - A.I. tools such LLM models can much more easily parse and generate documentation in a markdown format
    - Markdown that sits alongside code (either in the same directory structure or IDE workspace) is much more easily navigable by LLM tools
    - Diagrams as code can more easily be understood and generated by LLMs than actual diagrams or propriatary formats

## Our Approach

### Architecture Diagrams as Code

We prefer **LikeC4** for C4 architecture modeling:

- Diagrams defined in `.c4` files (text-based)
- Version controlled alongside documentation
- Automatically rendered to images for multiple outputs
- Consistent styling via shared `specification.c4` files

**Example Structure:**
```
architecture/
├── specification.c4       # Shared element types and styles
└── defra-wide/
    └── defra-landscape.c4  # Defra-wide architecture models
```

### Written Documentation

All written content lives in the `/docs` directory:

- **Markdown** (`.md`, `.mdx`) for all text content
- Visible directly in GitHub
- Rendered to multiple formats automatically
- Structured consistently across verticals

**Example Structure:**
```
docs/
├── index.mdx              # Homepage
├── systems/
│   └── my-system/
│       └── overview.md
└── architecture/
    └── decisions/
        └── adr-001.md
```

### Single Source, Multiple Outputs

One source of truth generates multiple formats:

```
/docs (source)
    ↓
    ├─→ GitHub Pages (via Astro)
    ├─→ Confluence (via automation)
    ├─→ PowerPoint (via Marp)
    └─→ PDF (via markdown-pdf)
```

### Automation & CI/CD

GitHub Actions workflows handle:

- **Build**: Generate diagrams and render documentation
- **Validate**: Check C4 models and markdown syntax
- **Deploy**: Publish to GitHub Pages automatically
- **Publish**: Push updates to Confluence
- **Export**: Generate PDFs and PowerPoint presentations

## Principles

### 1. Documentation is Code

- Treat documentation with the same care as code
- Use code review processes
- Follow coding best practices (DRY, maintainability, clarity)

### 2. Single Source of Truth

- Never duplicate content
- Reference, don't copy
- Generate outputs, don't maintain separately

### 3. Version Control Everything

- All documentation in Git
- All diagrams as code
- All configuration in repositories

### 4. Automate Everything Possible

- Build processes
- Deployment
- Validation
- Format conversion

### 5. Make it Visible

- Documentation in GitHub (not hidden in tools)
- Easy to find and navigate
- Accessible to all team members

### 6. Consistency Across Defra

- Shared templates and tooling
- Common structure and conventions
- Reusable components and patterns

## Standard Structure

All Defra vertical documentation repositories follow this structure:

```
my-vertical-docs/
├── architecture/              # Architecture diagrams as code
│   ├── specification.c4     # Shared C4 element types
│   └── [vertical]/            # Vertical-specific models
│       ├── c4/                # C4 architecture diagrams
│       └── mmd/               # Mermaid sequence diagrams
├── docs/                      # Written documentation (source of truth)
│   ├── index.mdx              # Homepage
│   ├── systems/               # System documentation
│   └── architecture/           # Architecture decisions
├── astro/                     # Web documentation (generated)
│   └── src/content/docs -> ../../../docs  # Symlink
├── generated/                 # Generated files (gitignored)
│   ├── diagrams/              # Exported LikeC4 diagrams (PNG)
│   ├── pdf/                   # Generated PDF files
│   └── pptx/                  # Generated PowerPoint files
├── scripts/                   # Automation scripts
└── .github/workflows/         # CI/CD workflows
```

## Tooling

### Core Tools

- **LikeC4**: C4 architecture modeling
- **Astro + Starlight**: Web documentation framework
- **Mermaid**: Sequence and flow diagrams
- **Markdown**: Text documentation format
- **GitHub Actions**: CI/CD automation

### Shared Library

The [`@defra/delivery-info-arch-tooling`](https://github.com/DEFRA/delivery-info-arch-tooling) package provides:

- Confluence publishing automation
- PowerPoint generation
- PDF export
- Diagram rendering
- Common utilities

## Getting Started

### For New Verticals

1. **Clone the template repository**:
   ```bash
   git clone https://github.com/DEFRA/delivery-information-architecture.git my-vertical-docs
   ```

2. **Customize for your vertical**:
   - Replace example content with your systems
   - Update configuration files
   - Add your C4 models and documentation

3. **Follow the structure**:
   - Architecture diagrams in `/architecture`
   - Written docs in `/docs`
   - Keep automation in place

See the [README](README.md#using-as-a-template) for detailed setup instructions.

### For Existing Projects

1. **Migrate existing documentation**:
   - Convert to markdown format
   - Move to `/docs` directory
   - Structure following conventions

2. **Add architecture diagrams**:
   - Create C4 models for your systems
   - Use shared `specification.c4` for consistency

3. **Set up automation**:
   - Configure GitHub Actions workflows
   - Set up Confluence publishing (optional)
   - Enable GitHub Pages

## Best Practices

### Documentation

- ✅ Write in clear, concise markdown
- ✅ Use consistent heading structure
- ✅ Include diagrams where helpful
- ✅ Keep documentation up-to-date with code
- ✅ Review documentation in pull requests
- ❌ Don't duplicate content
- ❌ Don't use proprietary formats
- ❌ Don't maintain separate copies

### Architecture Diagrams

- ✅ Use C4 model conventions
- ✅ Reference shared `specification.c4`
- ✅ Keep diagrams focused and clear
- ✅ Version control all diagram files
- ❌ Only create diagrams in GUI tools if you need to
- ❌ Only export images manually if you need to

### Collaboration

- ✅ Use pull requests for all changes
- ✅ Request reviews from team members
- ✅ Use descriptive commit messages
- ✅ Keep changes focused and small
- ❌ Don't commit directly to main
- ❌ Don't bypass review process

## Examples

### Trade Imports Documentation

The [Trade Imports Documentation](https://github.com/DEFRA/trade-imports-documentation) repository demonstrates:

- Complete documentation-as-code setup
- Multiple systems (BTMS, IPAFFS, DMP)
- Automated Confluence publishing
- GitHub Pages deployment
- PDF and PowerPoint generation

### This Repository

This repository serves as:

- Defra-wide architecture view
- Starter template for new verticals
- Example of documentation-as-code approach

## Resources

- [Tooling Library](https://github.com/DEFRA/delivery-info-arch-tooling) - Shared automation tools
- [LikeC4 Documentation](https://likec4.dev) - Architecture diagramming
- [Astro Starlight](https://starlight.astro.build) - Documentation framework
- [C4 Model](https://c4model.com) - Architecture modeling methodology

## Questions?

For questions or support:

1. Check the [README](README.md) for setup instructions
2. Review the [tooling documentation](https://github.com/DEFRA/delivery-info-arch-tooling)
3. Look at [example repositories](https://github.com/DEFRA/trade-imports-documentation)
4. Open an issue in the relevant repository

---

**Remember**: Documentation as Code means treating documentation with the same care, tooling, and processes as software code. This ensures our documentation is maintainable, collaborative, and always up-to-date.
